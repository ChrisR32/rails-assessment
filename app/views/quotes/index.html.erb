<main class="container-fluid">
    <div class="row">
    
        <%= render "pages/sidebar" %>

        <!-- start of main content -->
        <div class="col-sm-9">
            <h1 class="h1 page-header">View Quotes for this Listing</h1>

            <%if @amount_of_user_quotes == 0 %>
                
                <%if current_user.user_type == "designer"%>

                    <p class="subtitle">There are no quotes attached to this listing.</p>

                <% else %>

                    <p class="subtitle"> You have not made any quotes for this listing. </p>
                    <div class="col-md-12 hidden-sm-up">
                        <%=link_to "Create Quote", new_quote_path(listing: params[:listing]), class: "button_link" %>
                    </div>

                <%end%>

                <div class="col-md-12 hidden-sm-up">
                    <%= link_to 'Back to Listings', listings_path, class: "button_link" %>
                </div>

            <%end%>
            
            <div class="col-md-12 hidden-sm-up">
                <%= link_to 'Back to Dashboard', dashboard_path, class: "button_link" %>
            </div>


            <%@amount_of_user_quotes = 0%>

            <%if current_user.user_type == "designer"%>
                <% @quotes.each do |quote| %>
                <!-- if user is a designer, show all quotes for this listing -->
                    <%if quote.listing_id == params[:listing].to_i%>
                    <div class="card">
                        <p>Quote Id: <%= quote.id %></p>
                        <p>Printer Id: <%= quote.printer_id %></p>
                        <p>Printer Postcode: <%=quote.printer.user.postcode%><p>
                        <p>Listing Id: <%= quote.listing_id %></p>
                        <p>Total Price: $<%= number_with_precision(quote.total_price, precision: 2) %></p>
                        <p>Job Size (cubic cm): <%= quote.job_size %></p>
                        <p>Turnaround Time: <%= quote.turnaround_time %></p>
                        
                        <%if current_user.user_type == "printer"%>
                            <%= link_to "Edit", edit_quote_path(quote.id) %>
                        <% end %>
                        <%= link_to "Show",quote_path(quote.id) %>
                        <%@amount_of_user_quotes += 1%>
                    </div>
                    <%end%>
                <% end %>


            <%else%>

                <% @quotes.each do |quote| %>
                    <%if quote.listing_id == params[:listing].to_i%>

                        <%if Printer.find(quote.printer_id).user_id == current_user.id%>
                            <!-- if user is a printer, show all quotes they have made for this listing -->
                            <div class="card">
                                <p>Quote Id: <%= quote.id %></p>
                                <p>Printer Id: <%= quote.printer_id %></p>
                                <p>Listing Id: <%= quote.listing_id %></p>
                                <p>Total Price: $<%= number_with_precision(quote.total_price, precision: 2) %></p>
                                <p>Job Size (cubic cm): <%= quote.job_size %></p>
                                <p>Turnaround Time: <%= quote.turnaround_time %></p>
                                <%= link_to "Edit", edit_quote_path(quote.id) %>
                                <!-- Only show edit link for printers -->  
                                <%= link_to "Show",quote_path(quote.id) %>
                                <%@amount_of_user_quotes += 1%>
                            </div>
                        <%end%>

                    <%end%>
                <% end %>
            <%end%>

        </div>
        <!-- end of main content -->
    </div>
</main>